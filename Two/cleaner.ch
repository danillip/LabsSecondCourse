#!/bin/bash

# Функция для проверки и удаления битых символических ссылок
check_and_remove_broken_links() {
    local file="$1"

    # Проверяем, является ли файл символической ссылкой
    if [ -L "$file" ]; then
        # Проверяем, существует ли файл, на который указывает символическая ссылка
        if [ ! -e "$file" ]; then
            # Удаляем битую символическую ссылку
            rm "$file"
            echo "Удалена битая символическая ссылка: $file"
        fi
    fi
}

# Функция для обхода каталогов
traverse() {
    local dir="$1"
    local file

    # Проходимся по всем файлам и папкам в текущем каталоге
    for file in "$dir"/*; do
        # Проверяем, является ли текущий элемент папкой
        if [ -d "$file" ]; then
            # Рекурсивно вызываем эту функцию для обхода этой папки
            traverse "$file"
        fi

        # Проверяем и удаляем битые символические ссылки для текущего файла или папки
        check_and_remove_broken_links "$file"
    done
}

# Переходим в каталог, из которого был запущен скрипт
cd "$(dirname "$0")" || exit

# Вызываем функцию для обхода каталогов, начиная с текущего
traverse .

echo "Очистка битых символических ссылок завершена."

